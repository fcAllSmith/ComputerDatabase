package com.excilys.computerdb.fconsigny.storage.database;

import com.zaxxer.hikari.HikariConfig;
import com.zaxxer.hikari.HikariDataSource;

import java.io.FileInputStream;
import java.sql.Connection;
import java.util.Properties;

import javax.sql.DataSource;
import org.apache.log4j.Logger;

public class Database {

  private static Database instance;

  private ThreadLocal<Connection> localConnection = new ThreadLocal<Connection>();

  private static Logger logger = Logger.getLogger(Database.class);

  private Connection connection;
  private static final String JDB_DRIVER = "com.mysql.jdbc.Driver";

  private Database(Connection connection) {
    this.connection = connection; 
  }

  public static Database getInstance(Connection connection) {
    if (instance == null) {
      instance = new Database(connection);
    }
    return instance;
  }

  public static DataSource getDataSource() throws ClassNotFoundException {
    Properties properties = new Properties();
    FileInputStream file = null;
    try {
      Class.forName(JDB_DRIVER);
      HikariConfig conf = new HikariConfig();
      conf.setJdbcUrl(properties.getProperty("DB_URL"));
      conf.setUsername(properties.getProperty("DB_USERNAME"));
      conf.setPassword(properties.getProperty("DB_PASSWORD"));
      conf.setAutoCommit(false);
      conf.setMaximumPoolSize(10);
      return new HikariDataSource(conf);
    } catch (ClassNotFoundException e) {
      logger.error(e);
      return null;
    }
  }
}
